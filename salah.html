<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Noor Al Huda ‚Äî Salah</title>
<style>
  body { margin:0; font-family:Arial,sans-serif; background:#f4f6f8; color:#222; transition:background 0.3s,color 0.3s; }
  header { background:#2e7d32; color:#fff; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; }
  header .brand { display:flex; align-items:center; gap:10px; }
  header .brand img { height:40px; }
  header h1 { margin:0; font-size:1.2rem; }
  header .arabic { font-family:"Amiri",serif; }
  #mainNav { display:flex; gap:0.5rem; }
  #mainNav a, #mainNav button {
    background:#fff; color:#0b7d40; padding:0.4rem 0.9rem; border-radius:20px; font-weight:600;
    text-decoration:none; border:none; cursor:pointer; transition:background 0.2s,color 0.2s;
  }
  #mainNav a:hover, #mainNav button:hover { background:#065c2f; color:#fff; }
  .hamburger { display:none; font-size:1.5rem; background:none; border:none; color:#fff; cursor:pointer; }
  @media(max-width:768px){
    #mainNav{display:none;flex-direction:column;background:#0b7d40;position:absolute;top:60px;right:0;padding:1rem;}
    #mainNav.open{display:flex;}
    .hamburger{display:block;}
  }

  .container { max-width:900px; margin:20px auto; background:#fff; border:1px solid #d8dee4; border-radius:8px; padding:20px; }
  .controls { display:flex; gap:10px; align-items:center; margin-bottom:16px; flex-wrap:wrap; }
  .controls select { padding:6px 10px; border-radius:6px; border:1px solid #cfd7e3; }
  .card { border:1px solid #d8dee4; border-radius:8px; padding:12px; background:#fff; }
  .card h3 { margin:0 0 8px; font-size:1rem; color:#0b7d40; }
  .row { display:flex; justify-content:space-between; padding:6px 0; border-bottom:1px dashed #e5e7eb; }
  .row:last-child { border-bottom:none; }

  /* Dark mode */
  body.dark-mode { background:#0f1216; color:#e7ebf0; }
  body.dark-mode header { background:#1f6a28; }
  body.dark-mode #mainNav a, body.dark-mode #mainNav button { background:#1e2430; color:#e7ebf0; }
  body.dark-mode #mainNav a:hover, body.dark-mode #mainNav button:hover { background:#4fb477; color:#fff; }
  body.dark-mode .container { background:#161a20; border-color:#2a3140; }
  body.dark-mode .card { background:#121621; border-color:#2a3140; }
  body.dark-mode .card h3 { color:#4fb477; }
</style>
</head>
<body>

<header>
  <div class="brand">
    <img src="logo.png.png" alt="Noor Al Huda Logo">
    <h1>Noor Al Huda <span class="arabic">ŸÜŸàÿ± ÿßŸÑŸáÿØŸâ</span></h1>
  </div>
  <button class="hamburger" onclick="toggleMenu()">‚ò∞</button>
  <nav id="mainNav">
    <a href="quran.html">üìñ Qur‚Äôan</a>
    <a href="duas.html">ü§≤ Duas</a>
    <a href="hadiths-home.html">üìú Hadiths</a>
    <a href="calendar.html">üìÖ Calendar</a>
    <a href="salah.html" class="active">üïå Salah</a>
    <a href="index.html" class="utility">üè†</a>
    <a href="settings.html" class="utility">‚öô</a>
    <button class="btn utility" id="themeToggle" onclick="toggleDarkMode()">üåô</button>
  </nav>
</header>

<div class="container" id="content" style="font-size:16px">
  <div class="controls">
    <label>
      <strong>City:</strong>
      <select id="citySelect">
        <option value="London">London (UK)</option>
        <option value="Bedford">Bedford (UK)</option>
        <option value="Islamabad">Islamabad (Pakistan)</option>
        <option value="Tehran">Tehran (Iran)</option>
        <option value="Karbala">Karbala (Iraq)</option>
      </select>
    </label>
    <span id="tzLabel"></span>
    <span id="dateLabel"></span>
  </div>

  <div class="card">
    <h3 id="cityTitle">Salah times</h3>
    <div class="row"><span>Fajr</span><span id="fajr">‚Äî</span></div>
    <div class="row"><span>Sunrise</span><span id="sunrise">‚Äî</span></div>
    <div class="row"><span>Dhuhr</span><span id="dhuhr">‚Äî</span></div>
    <div class="row"><span>Asr</span><span id="asr">‚Äî</span></div>
    <div class="row"><span>Maghrib</span><span id="maghrib">‚Äî</span></div>
    <div class="row"><span>Isha</span><span id="isha">‚Äî</span></div>
  </div>
</div>

<script>
/* Header interactions + theme */
function toggleMenu(){document.getElementById("mainNav").classList.toggle("open");}
function toggleDarkMode(){
  document.body.classList.toggle("dark-mode");
  localStorage.setItem("theme", document.body.classList.contains("dark-mode") ? "dark" : "light");
}
(function restoreTheme(){
  if(localStorage.getItem("theme")==="dark"){document.body.classList.add("dark-mode");}
})();

/* Settings integration: font size + country default */
(function applySettings(){
  const font = parseInt(localStorage.getItem("font_size")||"16",10);
  document.getElementById("content").style.fontSize = Math.min(Math.max(font, 12), 22) + "px";
  const country = localStorage.getItem("country") || "United Kingdom";
  const citySelect = document.getElementById("citySelect");
  if(country==="United Kingdom"){ citySelect.value="Bedford"; }
})();

/* City data */
const CITIES = {
  London:   { lat:51.5074, lon:-0.1278, tz:"Europe/London" },
  Bedford:  { lat:52.1364, lon:-0.4670, tz:"Europe/London" },
  Islamabad:{ lat:33.6844, lon:73.0479, tz:"Asia/Karachi" },
  Tehran:   { lat:35.6892, lon:51.3890, tz:"Asia/Tehran" },
  Karbala:  { lat:32.6160, lon:44.0246, tz:"Asia/Baghdad" }
};

/* Timezone offset */
function tzOffsetMinutes(tz, date){
  const y = date.getUTCFullYear();
  function lastSunday(m){
    const d = new Date(Date.UTC(y, m+1, 0));
    d.setUTCDate(d.getUTCDate() - d.getUTCDay());
    return d;
  }
  if(tz==="Europe/London"){
    const s = lastSunday(2), e = lastSunday(9);
    const now = Date.UTC(y,date.getUTCMonth(),date.getUTCDate(),date.getUTCHours(),date.getUTCMinutes());
    const sUTC = Date.UTC(y,s.getUTCMonth(),s.getUTCDate(),1,0);
    const eUTC = Date.UTC(y,e.getUTCMonth(),e.getUTCDate(),1,0);
    return (now>=sUTC && now<eUTC)?60:0;
  }
  if(tz==="Asia/Karachi") return 300;
  if(tz==="Asia/Tehran")  return 210;
  if(tz==="Asia/Baghdad") return 180;
  return -date.getTimezoneOffset();
}

/* Astronomical helpers */
const RAD=Math.PI/180;
function toRad(x){return x*RAD;}
function toDeg(x){return x/RAD;}
function normalizeAngle(a){a%=360;return a<0?a+360:a;}
function julianDay(d){
  return Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate(),0,0)/86400000+2440587.5;
}
function solarMeanAnomaly(d){return toRad(normalizeAngle(357.5291+0.98560028*d));}
function eclipticLongitude(M){
  const C=toRad(1.9148)*Math.sin(M)+toRad(0.0200)*Math.sin(2*M)+toRad(0.0003)*Math.sin(3*M);
  return M+C+toRad(102.9372)+Math.PI;
}
function declination(L){return Math.asin(Math.sin(toRad(23.4397))*Math.sin(L));}
function equationOfTime(M,L){
  const e=toRad(23.4397), y=Math.tan(e/2), y2=y*y;
  return toDeg(y2*Math.sin(2*L)-2*0.0167*Math.sin(M)+4*0.0167*y2*Math.sin(M)*Math.cos(2*L)
    -0.5*y2*y2*Math.sin(2*L)-1.25*0.0167*0.0167*Math.sin(2*M))*4;
}
function hourAngle(lat,dec,alt){
  const h=toRad(alt), p=toRad(lat);
  const c=(Math.sin(h)-Math.sin(p)*Math.sin(dec))/(Math.cos(p)*Math.cos(dec));
  if(c<-1||c>1) return null;
  return Math.acos(c);
}

/* Compute solar times UTC-min */
function solarTimesUTC(date,lat,lon){
  const JD=julianDay(date)-2451545.0;
  const M=solarMeanAnomaly(JD), L=eclipticLongitude(M), dec=declination(L);
  const E=equationOfTime(M,L), noon=720-4*lon-E;
  let H0=hourAngle(lat,dec,-0.833), sr=null, ss=null;
  if(H0!==null){const d=toDeg(H0); sr=noon-4*d; ss=noon+4*d;}
  const Hf=hourAngle(lat,dec,-17.7), Hi=hourAngle(lat,dec,-14.0);
  const fajr = Hf!==null ? noon-4*toDeg(Hf) : null;
  const isha = Hi!==null ? noon+4*toDeg(Hi) : null;
  const phi=toRad(lat), n=1;
  const Ha=hourAngle(lat,dec,toDeg(Math.atan(1/(n+Math.tan(Math.abs(phi-dec))))));
  const asr  = Ha!==null ? noon+4*toDeg(Ha) : null;
  const dhuhr=noon, maghrib=ss!==null?ss+12:null;
  return { fajrUTC:fajr, sunriseUTC:sr, dhuhrUTC:dhuhr, asrUTC:asr, maghribUTC:maghrib, ishaUTC:isha };
}

/* Fallback for polar extremes */
function ensureTwilightFallback(t){
  if(t.sunriseUTC===null||t.maghribUTC===null) return t;
  const night=((24*60)-t.maghribUTC)+t.sunriseUTC;
  if(t.fajrUTC===null) t.fajrUTC=t.sunriseUTC-night*(1/7);
  if(t.ishaUTC===null)t.ishaUTC=t.maghribUTC+night*(1/7);
  return t;
}

/* Format to hh:mm */
function toLocalTimeStr(u,m){
  if(u===null) return "‚Äî";
  let total=Math.round(u+m)%(24*60);
  if(total<0) total+=24*60;
  const hh=Math.floor(total/60), mm=total%60;
  return String(hh).padStart(2,"0")+":"+String(mm).padStart(2,"0");
}

/* Normalize labels to keys */
function resolveCity(key){
  if(CITIES[key]) return key;
  const map={
    "london (uk)":"London",
    "bude (uk)":"Bedford",
    "bedford (uk)":"Bedford",
    "islamabad (pakistan)":"Islamabad",
    "tehran (iran)":"Tehran",
    "karbala (iraq)":"Karbala"
  };
  return map[key.toLowerCase()]||"Bedford";
}

/* Render a city‚Äôs times */
function renderCity(raw, date){
  const key=resolveCity(raw), city=CITIES[key];
  const off=tzOffsetMinutes(city.tz, date);
  let t=solarTimesUTC(date,city.lat,city.lon);
  t=ensureTwilightFallback(t);
  document.getElementById("cityTitle").textContent=`Salah times ‚Äî ${key}`;
  document.getElementById("tzLabel").textContent=city.tz;
  document.getElementById("dateLabel").textContent=date.toLocaleDateString();
  document.getElementById("fajr").textContent    =toLocalTimeStr(t.fajrUTC,off);
  document.getElementById("sunrise").textContent =toLocalTimeStr(t.sunriseUTC,off);
  document.getElementById("dhuhr").textContent   =toLocalTimeStr(t.dhuhrUTC,off);
  document.getElementById("asr").textContent     =toLocalTimeStr(t.asrUTC,off);
  document.getElementById("maghrib").textContent =toLocalTimeStr(t.maghribUTC,off);
  document.getElementById("isha").textContent    =toLocalTimeStr(t.ishaUTC,off);
}

/* City selector */
document.getElementById("citySelect").addEventListener("change", e=>{
  renderCity(e.target.value,new Date());
});

/* Auto-update */
(function autoUpdate(){
  let lastDay=null;
  function upd(){
    const sel=document.getElementById("citySelect").value;
    const now=new Date();
    renderCity(sel,now);
    lastDay=now.toDateString();
  }
  setInterval(upd,60*1000);
  function sched(){
    const n=new Date();
    const nxt=new Date(n.getFullYear(),n.getMonth(),n.getDate()+1,0,5);
    setTimeout(()=>{upd();sched();},nxt - n);
  }
  upd();sched();
})();
</script>
</body>
</html>
